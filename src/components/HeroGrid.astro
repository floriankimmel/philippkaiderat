---
interface Section {
  title: string;
  subtitle?: string;
  href: string;
  hoverImage: string;
}

interface Props {
  sections: Section[];
  defaultImage: string;
}

const { sections, defaultImage } = Astro.props;
---

<div id="hero-grid" class="hero-grid">
  <!-- Background layers for smooth crossfade -->
  <div class="hero-bg hero-bg--default active" style={`background-image: url('${defaultImage}')`}></div>
  {sections.map((section, index) => (
    <div
      class="hero-bg"
      data-bg-index={index}
      style={`background-image: url('${section.hoverImage}')`}
    ></div>
  ))}

  <div class="hero-grid__overlay"></div>

  {sections.map((section, index) => (
    <a
      href={section.href}
      class="hero-section"
      data-index={index}
      style={`--section-bg: url('${section.hoverImage}')`}
    >
      <div class="hero-section__content">
        <h2 class="hero-section__title">{section.title}</h2>
        {section.subtitle && (
          <p class="hero-section__subtitle">{section.subtitle}</p>
        )}
      </div>
    </a>
  ))}
</div>

<style>
  .hero-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    min-height: 100svh;
    position: relative;
  }

  .hero-bg {
    position: absolute;
    inset: 0;
    background-size: cover;
    background-position: center;
    opacity: 0;
    transition: opacity 0.5s ease;
    z-index: 0;
  }

  .hero-bg.active {
    opacity: 1;
  }

  .hero-grid__overlay {
    position: absolute;
    inset: 0;
    background: rgba(0, 0, 0, 0.4);
    pointer-events: none;
    z-index: 1;
  }

  .hero-section {
    position: relative;
    z-index: 2;
    display: flex;
    align-items: flex-end;
    justify-content: center;
    padding: 2rem;
    text-decoration: none;
    color: white;
    border-right: 1px solid rgba(255, 255, 255, 0.1);
    transition: background-color 0.3s ease;
  }

  .hero-section:last-child {
    border-right: none;
  }

  .hero-section:hover {
    background-color: rgba(255, 255, 255, 0.05);
  }

  .hero-section__content {
    text-align: center;
    padding-bottom: 4rem;
  }

  .hero-section__title {
    font-family: var(--font-display);
    font-size: clamp(1.25rem, 2vw, 1.75rem);
    font-weight: 600;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    margin: 0;
  }

  .hero-section__subtitle {
    font-size: 0.875rem;
    opacity: 0.7;
    margin-top: 0.5rem;
  }

  /* Mobile: stack vertically with individual backgrounds */
  @media (max-width: 768px) {
    .hero-grid {
      grid-template-columns: 1fr;
      grid-template-rows: repeat(4, 1fr);
    }

    .hero-bg,
    .hero-grid__overlay {
      display: none;
    }

    .hero-section {
      border-right: none;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      align-items: center;
      background-image: var(--section-bg);
      background-size: cover;
      background-position: center;
      position: relative;
    }

    .hero-section::before {
      content: '';
      position: absolute;
      inset: 0;
      background: rgba(0, 0, 0, 0.4);
      pointer-events: none;
    }

    .hero-section:last-child {
      border-bottom: none;
    }

    .hero-section__content {
      padding-bottom: 0;
      position: relative;
      z-index: 1;
    }
  }
</style>

<script>
  const defaultBg = document.querySelector('.hero-bg--default') as HTMLElement;
  const bgLayers = document.querySelectorAll('.hero-bg[data-bg-index]');
  const sections = document.querySelectorAll('.hero-section');

  sections.forEach((el) => {
    const section = el as HTMLElement;
    const index = section.dataset.index;

    section.addEventListener('mouseenter', () => {
      // Hide default
      defaultBg?.classList.remove('active');
      // Hide all others
      bgLayers.forEach(bg => bg.classList.remove('active'));
      // Show this one
      const targetBg = document.querySelector(`.hero-bg[data-bg-index="${index}"]`);
      targetBg?.classList.add('active');
    });

    section.addEventListener('mouseleave', () => {
      // Hide all
      bgLayers.forEach(bg => bg.classList.remove('active'));
      // Show default
      defaultBg?.classList.add('active');
    });
  });
</script>
